name: Create Prerelease Branch

on:
  push:
    branches:
      - chore/create-prerelease-branch-build-action

jobs:
  build:
    strategy:
      fail-fast: true

    timeout-minutes: 5

    runs-on: ubuntu-latest

    steps:
      - name: Checkout source
        uses: actions/checkout@v2
        with:
          ref: master

      - name: Checkout Branch
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          version=`cat ./packages/plugin-core/package.json | jq ".version" -r | awk -F. -v OFS=. 'NF==1{print ++$NF}; NF>1{$NF=sprintf("%0*d", length($NF), ($NF+1)); print}'`
          branchName="prerelease/${version}" 
          echo $branchName
          git checkout -b $branchName
          git push origin $branchName
